{% extends 'layout/manage.html' %}
{% load static %}

{% block title %}
    <title>问题管理</title>
{% endblock %}
{% block css %}
    <link rel="stylesheet" href="{% static 'plugin/editor-md/css/editormd.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugin/bootstrap-datepicker/bootstrap-datepicker.css' %}">
    <link rel="stylesheet" href="{% static 'plugin/bootstrap-select/bootstrap-select.min.css' %}">
    <style>
        .set-box {
            width: 1800px;
            margin: auto;
        }

        .comment-area .left-avatar {
            float: left;
            margin-right: 10px;
            display: inline-block;
            width: 30px;
            height: 30px;
            background-color: #1d5e9a;
            color: white;
            text-align: center;
            line-height: 30px;
            border-radius: 50%;
        }

        .comment-area .right-info {
            padding-left: 35px;
        }

        .comment-area .item {
            width: 700px;
        }

        .child .item {
            width: 655px;
        }

        .comment-area .right-info .desc .msg {
            display: inline-block;
            padding-right: 20px;
            color: #8c8c8c;
        }

        .comment-area .child {
            padding-left: 45px;
        }

        .comment-area .error-msg {
            color: red;
        }

        .comment-area .comment-list {
            width: 100%;
            height: 603px;
            overflow: hidden; /* 设置溢出时显示滚动条 */
        }

        .comment-area .comment-list:hover {
            overflow: auto; /* 滑动时显示滚动条 */
        }

        /* 设置滚动条的样式（WebKit内核浏览器） */
        .comment-area .comment-list::-webkit-scrollbar {
            width: 5px; /* 滚动条宽度 */
        }

        .comment-area .comment-list::-webkit-scrollbar-thumb {
            background-color: #888; /* 滚动条滑块颜色 */
            border-radius: 5px; /* 滚动条滑块圆角 */
        }

        .comment-area .comment-list::-webkit-scrollbar-track {
            background-color: #eee; /* 滚动条轨道颜色 */
            border-radius: 5px; /* 滚动条轨道圆角 */
        }

        .comment-area .reply-user {
            display: inline-block;
            background-color: #ddd;
            color: black;
            padding: 6px 8px;
            margin-left: 20px;
            border-radius: 8px;
            cursor: pointer;
        }

        .comment-area .reply {
            margin-right: 25px;
        }

        .comment-area .comment-list pre {
            white-space: pre-wrap; /* 保留空白字符，自动换行 */
            word-wrap: break-word; /* 在单词内换行 */
        }

        .panel-body_1 {
            padding: 10px 0 10px 10px;
        }

    </style>
{% endblock %}

{% block content %}
    <div class="set-box">
        <div class="col-sm-7">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4><i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                        更新面板</h4>
                </div>
                <div class="panel-body">
                    <form id="addIssuesForm" class="form-horizontal">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="{{ form.issues_type.id_for_label }}" class="col-md-2 control-label">
                                {{ form.issues_type.label }}
                            </label>
                            <div class="col-md-10">
                                <div>
                                    {{ form.issues_type }}
                                </div>
                                <div class="error-msg"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="{{ form.subject.id_for_label }}" class="col-md-2 control-label">
                                {{ form.subject.label }}
                            </label>
                            <div class="col-md-10">
                                <div>
                                    {{ form.subject }}
                                </div>
                                <div class="error-msg"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="{{ form.module.id_for_label }}" class="col-md-2 control-label">
                                {{ form.module.label }}
                            </label>
                            <div class="col-md-10">
                                {{ form.module }}
                                <div class="error-msg"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="{{ form.desc.id_for_label }}" class="col-md-2 control-label">
                                {{ form.desc.label }}
                            </label>
                            <div class="col-md-10">
                                <div id="editor">
                                    {{ form.desc }}
                                </div>
                                <div class="error-msg"></div>
                            </div>
                        </div>
                        <div class="form-group clearfix">
                            <div class="col-md-6 pd-0">
                                <div class="form-group">
                                    <label for="{{ form.state.id_for_label }}" class="col-md-3 control-label">
                                        {{ form.state.label }}
                                    </label>
                                    <div class="col-md-8">
                                        {{ form.state }}
                                        <div class="error-msg"></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="{{ form.parent.id_for_label }}" class="col-md-3 control-label">
                                        {{ form.parent.label }}
                                    </label>
                                    <div class="col-md-8">
                                        {{ form.parent }}
                                        <div class="error-msg"></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="{{ form.priority.id_for_label }}" class="col-md-3 control-label">
                                        {{ form.priority.label }}
                                    </label>
                                    <div class="col-md-8">
                                        {{ form.priority }}
                                        <div class="error-msg"></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="{{ form.assign.id_for_label }}" class="col-md-3 control-label">
                                        {{ form.assign.label }}
                                    </label>
                                    <div class="col-md-8">
                                        {{ form.assign }}
                                        <div class="error-msg"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 pd-0">
                                <div class="form-group">
                                    <label for="{{ form.attention.id_for_label }}" class="col-md-3 control-label">
                                        {{ form.attention.label }}
                                    </label>
                                    <div class="col-md-8">
                                        {{ form.attention }}
                                        <div class="error-msg"></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="{{ form.start_date.id_for_label }}" class="col-md-3 control-label">
                                        {{ form.start_date.label }}
                                    </label>
                                    <div class="col-md-8">
                                        <div class="input-group">
                                            <span class="input-group-addon" id="sizing-addon2">
                                                <i class="fa fa-calendar" aria-hidden="true"></i>
                                            </span>
                                            {{ form.start_date }}
                                        </div>
                                        <div class="error-msg"></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="{{ form.end_date.id_for_label }}" class="col-md-3 control-label">
                                        {{ form.end_date.label }}
                                    </label>
                                    <div class="col-md-8">
                                        <div class="input-group">
                                            <span class="input-group-addon" id="sizing-addon2">
                                                <i class="fa fa-calendar" aria-hidden="true"></i>
                                            </span>
                                            {{ form.end_date }}
                                        </div>
                                        <div class="error-msg"></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="{{ form.mode.id_for_label }}" class="col-md-3 control-label">
                                        {{ form.mode.label }}
                                    </label>
                                    <div class="col-md-8">
                                        {{ form.mode }}
                                        <div class="error-msg"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>


        <div class="col-sm-5">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4><i class="fa fa-search" aria-hidden="true"></i>
                        操作记录</h4>
                </div>
                <div class="panel-body_1 comment-area">
                    <div class="comment-list">
                        <div class="item clearfix" id="test">
                            <div class="left-avatar">林</div>
                            <div class="right-info">
                                <pre>林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd</pre>
                                <div class="desc">
                                    <div class="msg">
                                        <i class="fa fa-bullhorn" aria-invalid="true"></i>
                                        <span class="type">评论</span>
                                    </div>
                                    <div class="msg">
                                        <i class="fa fa-user-o" aria-invalid="true"></i>
                                        <span class="user">林大侠</span>
                                    </div>
                                    <div class="msg">
                                        <i class="fa fa-clock-o" aria-invalid="true"></i>
                                        <span class="date">2011-15-5</span>
                                    </div>
                                    <a href="#" class="reply">
                                        <i class="fa fa-reply" aria-hidden="true"></i>
                                        回复
                                    </a>
                                    <i class="fa fa-commenting-o" aria-hidden="true"></i>
                                    <div class="testreply msg" onclick="showTheReply()">
                                        展示回复
                                    </div>
                                </div>
                            </div>
                            <div class="child">
                                <div class="item clearfix">
                                    <div class="left-avatar">林</div>
                                    <div class="right-info">
                                        <pre>林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd</pre>
                                        <div class="desc">
                                            <div class="msg">
                                                <i class="fa fa-bullhorn" aria-invalid="true"></i>
                                                <span class="type">评论</span>
                                            </div>
                                            <div class="msg">
                                                <i class="fa fa-user-o" aria-invalid="true"></i>
                                                <span class="user">林大侠</span>
                                            </div>
                                            <div class="msg">
                                                <i class="fa fa-clock-o" aria-invalid="true"></i>
                                                <span class="date">2011-15-5</span>
                                            </div>
                                            <a href="#" class="reply">
                                                <i class="fa fa-commenting-o" aria-hidden="true"></i>
                                                回复
                                            </a>
                                        </div>
                                    </div>
                                    <div class="child">

                                    </div>
                                </div>
                                <div class="item clearfix">
                                    <div class="left-avatar">林</div>
                                    <div class="right-info">
                                        <pre>林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd</pre>
                                        <div class="desc">
                                            <div class="msg">
                                                <i class="fa fa-bullhorn" aria-invalid="true"></i>
                                                <span class="type">评论</span>
                                            </div>
                                            <div class="msg">
                                                <i class="fa fa-user-o" aria-invalid="true"></i>
                                                <span class="user">林大侠</span>
                                            </div>
                                            <div class="msg">
                                                <i class="fa fa-clock-o" aria-invalid="true"></i>
                                                <span class="date">2011-15-5</span>
                                            </div>
                                            <a href="#" class="reply">
                                                <i class="fa fa-commenting-o" aria-hidden="true"></i>
                                                回复
                                            </a>
                                        </div>
                                    </div>
                                    <div class="child">

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="item clearfix" id="test_1">
                            <div class="left-avatar">林</div>
                            <div class="right-info">
                                <pre>林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd</pre>
                                <div class="desc">
                                    <div class="msg">
                                        <i class="fa fa-bullhorn" aria-invalid="true"></i>
                                        <span class="type">评论</span>
                                    </div>
                                    <div class="msg">
                                        <i class="fa fa-user-o" aria-invalid="true"></i>
                                        <span class="user">林大侠</span>
                                    </div>
                                    <div class="msg">
                                        <i class="fa fa-clock-o" aria-invalid="true"></i>
                                        <span class="date">2011-15-5</span>
                                    </div>
                                    <a href="#" class="reply">
                                        <i class="fa fa-reply" aria-hidden="true"></i>
                                        回复
                                    </a>
                                    <i class="fa fa-commenting-o" aria-hidden="true"></i>
                                    <div class="msg testreply" onclick="showTheReply()">
                                        展示回复
                                    </div>
                                </div>
                            </div>
                            <div class="child">
                                <div class="item clearfix">
                                    <div class="left-avatar">林</div>
                                    <div class="right-info">
                                        <pre>林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd</pre>
                                        <div class="desc">
                                            <div class="msg">
                                                <i class="fa fa-bullhorn" aria-invalid="true"></i>
                                                <span class="type">评论</span>
                                            </div>
                                            <div class="msg">
                                                <i class="fa fa-user-o" aria-invalid="true"></i>
                                                <span class="user">林大侠</span>
                                            </div>
                                            <div class="msg">
                                                <i class="fa fa-clock-o" aria-invalid="true"></i>
                                                <span class="date">2011-15-5</span>
                                            </div>
                                            <a href="#" class="reply">
                                                <i class="fa fa-commenting-o" aria-hidden="true"></i>
                                                回复
                                            </a>
                                        </div>
                                    </div>
                                    <div class="child">

                                    </div>
                                </div>
                                <div class="item clearfix">
                                    <div class="left-avatar">林</div>
                                    <div class="right-info">
                                        <pre>林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd林大侠——s'da's'da's'da's'd</pre>
                                        <div class="desc">
                                            <div class="msg">
                                                <i class="fa fa-bullhorn" aria-invalid="true"></i>
                                                <span class="type">评论</span>
                                            </div>
                                            <div class="msg">
                                                <i class="fa fa-user-o" aria-invalid="true"></i>
                                                <span class="user">林大侠</span>
                                            </div>
                                            <div class="msg">
                                                <i class="fa fa-clock-o" aria-invalid="true"></i>
                                                <span class="date">2011-15-5</span>
                                            </div>
                                            <a href="#" class="reply">
                                                <i class="fa fa-commenting-o" aria-hidden="true"></i>
                                                回复
                                            </a>
                                        </div>
                                    </div>
                                    <div class="child">

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr>
                    <form>
                        <textarea class="form-control" rows="5"></textarea>
                        <input type='button' value='PUSH' class='btn btn-primary btn-sm' onclick=''/>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="hide" id="recordTemplate">
        <div class="item clearfix">
            <div class="left-avatar"></div>
            <div class="right-info">
                <pre></pre>
                <div class="desc">
                    <div class="msg">
                        <i class="fa fa-bullhorn" aria-invalid="true"></i>
                        <span class="type"></span>
                    </div>
                    <div class="msg">
                        <i class="fa fa-user-o" aria-invalid="true"></i>
                        <span class="user"></span>
                    </div>
                    <div class="msg">
                        <i class="fa fa-clock-o" aria-invalid="true"></i>
                        <span class="date"></span>
                    </div>
                    <a href="#" class="reply">
                        <i class="fa fa-commenting-o" aria-hidden="true"></i>
                        回复
                    </a>
                </div>
            </div>
            <div class="child">

            </div>
        </div>
    </div>
{% endblock %}


{% block js %}
    <script src="{% static 'plugin/editor-md/editormd.min.js' %}"></script>
    <script src="{% static 'plugin/bootstrap-datepicker/bootstrap-datepicker.js' %}"></script>
    <script src="{% static 'plugin/bootstrap-datepicker/bootstrap-datepicker.zh-CN.min.js' %}"></script>
    <script src="{% static 'plugin/bootstrap-select/bootstrap-select.min.js' %}"></script>
    <script src="{% static 'plugin/bootstrap-select/defaults-zh_CN.min.js' %}"></script>

    <script>
        var upload_url = "{% url 'web:manage:wiki_upload' request.user.project.id %}";

        $(function () {
            initDatePicker();
            initEdtorMd();
        });

        function initDatePicker() {
            $("#id_start_date, #id_end_date").datepicker({
                format: "yyyy-mm-dd",
                startDate: "0",
                language: "zh-CN",
                autoclose: true
            });
        }

        function showTheReply() {
            var newrecord = $("#test")
            // 判断是否 存在 hide 类
            if (newrecord.find(".child").hasClass("hide")) {
                newrecord.find(".child").removeClass("hide");
                $("#test .testreply").text('显示回复')
            } else {
                newrecord.find(".child").addClass("hide");
                $("#test .testreply").text('隐藏回复');
            }
        }

        function initEdtorMd() {
            editormd('editor', {
                placeholder: "请输入内容",
                height: 400,
                path: "{% static 'plugin/editor-md/lib/' %}",
                // 允许本地上传图片
                imageUpload: true,
                // 上传的文件格式
                imageFormats: ["jpg", "jpeg", "png", "gif"],
                // 上传的地址
                imageUploadURL: upload_url,
                onload: function () {
                    this.previewing();
                },
                toolbarAutoFixed: false,
                toolbarIcons: function () {
                    // Or return editormd.toolbarModes[name]; // full, simple, mini
                    // Using "||" set icons align right.
                    return ["undo", "redo", "|", "bold", "hr", "|", "watch", "fullscreen", "image", "preview", "||", "save"]
                },
                toolbarCustomIcons: {
                    save: "<input type='button' value='保 存' class='btn btn-success btn-sm' onclick=''/>"
                },
            });
        }

    </script>

{% endblock %}